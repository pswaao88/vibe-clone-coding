# í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ë³´ì•ˆ ì£¼ì˜ì‚¬í•­

## âš ï¸ ì¤‘ìš”: ë³´ì•ˆ ê²½ê³ 

ì´ í”„ë¡œì íŠ¸ëŠ” **Cloud Functions ì—†ì´ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì§ì ‘ Firestoreì— ì“°ê¸°**ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

### ë³´ì•ˆ ìœ„í—˜

1. **í¬ì¸íŠ¸ ì¡°ìž‘ ê°€ëŠ¥ì„±**
   - í´ë¼ì´ì–¸íŠ¸ ì½”ë“œëŠ” ì‚¬ìš©ìžê°€ ë³¼ ìˆ˜ ìžˆìŒ
   - ë¸Œë¼ìš°ì € ê°œë°œìž ë„êµ¬ë¡œ ì½”ë“œ ìˆ˜ì • ê°€ëŠ¥
   - Security Rulesë¡œ ìµœëŒ€í•œ ë³´í˜¸í•˜ì§€ë§Œ ì™„ë²½í•˜ì§€ ì•ŠìŒ

2. **ì œí•œëœ ë³´ì•ˆ**
   - Security RulesëŠ” ê¸°ë³¸ì ì¸ ê²€ì¦ë§Œ ìˆ˜í–‰
   - ë³µìž¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê²€ì¦ ì–´ë ¤ì›€

### í˜„ìž¬ ë³´ì•ˆ ì¡°ì¹˜

#### Firestore Security Rules

1. **í¬ì¸íŠ¸ ìˆ˜ì • ì œí•œ**
   - ë³¸ì¸ë§Œ ìˆ˜ì • ê°€ëŠ¥
   - ì¶©ì „: ìµœëŒ€ 1,000,000ì›ê¹Œì§€ ì¦ê°€ í—ˆìš©
   - ê±°ëž˜: ìµœëŒ€ 10,000,000ì›ê¹Œì§€ ê°ì†Œ í—ˆìš©
   - ìŒìˆ˜ í¬ì¸íŠ¸ ë¶ˆê°€

2. **point_logs ë³´í˜¸**
   - ë³¸ì¸ë§Œ ìƒì„± ê°€ëŠ¥
   - ë³¸ì¸ë§Œ ì½ê¸° ê°€ëŠ¥
   - ìˆ˜ì •/ì‚­ì œ ë¶ˆê°€
   - ê¸ˆì•¡ ê²€ì¦ (ì–‘ìˆ˜, ìµœëŒ€ 10,000,000ì›)

3. **ê±°ëž˜ ê²€ì¦**
   - Firestore Transaction ì‚¬ìš© (ì›ìžì„± ë³´ìž¥)
   - ìž”ì•¡ ë¶€ì¡± ì‹œ ê±°ëž˜ ì‹¤íŒ¨
   - ìƒí’ˆ ìƒíƒœ í™•ì¸

### ê¶Œìž¥ ì‚¬í•­

#### í”„ë¡œë•ì…˜ í™˜ê²½

1. **Cloud Functions ì‚¬ìš© (ê¶Œìž¥)**
   - ì„œë²„ ì‚¬ì´ë“œì—ì„œ ëª¨ë“  ê±°ëž˜ ì²˜ë¦¬
   - í´ë¼ì´ì–¸íŠ¸ì—ì„œ í¬ì¸íŠ¸ ì¡°ìž‘ ë¶ˆê°€ëŠ¥
   - Blaze í”Œëžœ í•„ìš”í•˜ì§€ë§Œ ë¬´ë£Œ í• ë‹¹ëŸ‰ ì¶©ë¶„

2. **í˜„ìž¬ ë°©ì‹ ì‚¬ìš© ì‹œ**
   - Security Rulesë¥¼ ë” ì—„ê²©í•˜ê²Œ ì„¤ì •
   - ì •ê¸°ì ì¸ ê°ì‚¬ ë¡œê·¸ í™•ì¸
   - ì´ìƒ ê±°ëž˜ íŒ¨í„´ ëª¨ë‹ˆí„°ë§

#### ì¶”ê°€ ë³´ì•ˆ ê°•í™” ë°©ë²•

1. **ê±°ëž˜ í•œë„ ì„¤ì •**
   ```javascript
   // ì¼ì¼ ê±°ëž˜ í•œë„ ì²´í¬
   // point_logsì—ì„œ ì˜¤ëŠ˜ ê±°ëž˜ ë‚´ì—­ ì§‘ê³„
   // í•œë„ ì´ˆê³¼ ì‹œ ê±°ëž˜ ì°¨ë‹¨
   ```

2. **ì´ìƒ ê±°ëž˜ ê°ì§€**
   - ë¹„ì •ìƒì ìœ¼ë¡œ í° ê¸ˆì•¡ ê±°ëž˜
   - ì§§ì€ ì‹œê°„ ë‚´ ë°˜ë³µ ê±°ëž˜
   - ìŒìˆ˜ í¬ì¸íŠ¸ ì‹œë„

3. **ë¡œê·¸ ëª¨ë‹ˆí„°ë§**
   - ëª¨ë“  í¬ì¸íŠ¸ ë³€ê²½ ë¡œê·¸ ê¸°ë¡
   - ì •ê¸°ì ì¸ ë¡œê·¸ ê²€í† 
   - ì´ìƒ íŒ¨í„´ ì•Œë¦¼

### í˜„ìž¬ êµ¬í˜„ì˜ ìž¥ì 

1. **Blaze í”Œëžœ ë¶ˆí•„ìš”**
   - Spark í”Œëžœìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥ (ë¬´ë£Œ)
   - ê²°ì œìˆ˜ë‹¨ ë“±ë¡ ë¶ˆí•„ìš”

2. **ë¹ ë¥¸ ê°œë°œ**
   - ì„œë²„ ì½”ë“œ ì—†ì´ ë¹ ë¥´ê²Œ ê°œë°œ
   - ë°°í¬ ê°„ì†Œí™”

3. **ë¹„ìš© ì ˆê°**
   - Cloud Functions ë¹„ìš© ì—†ìŒ
   - Firestoreë§Œ ì‚¬ìš©

### í˜„ìž¬ êµ¬í˜„ì˜ ë‹¨ì 

1. **ë³´ì•ˆ ì·¨ì•½ì **
   - í´ë¼ì´ì–¸íŠ¸ì—ì„œ í¬ì¸íŠ¸ ì¡°ìž‘ ê°€ëŠ¥
   - Security Rulesë§Œìœ¼ë¡œëŠ” ì™„ë²½í•œ ë³´í˜¸ ì–´ë ¤ì›€

2. **ë³µìž¡í•œ ê²€ì¦ ì–´ë ¤ì›€**
   - ì¼ì¼ ê±°ëž˜ í•œë„ ì²´í¬ ì–´ë ¤ì›€
   - ë³µìž¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„ ì œí•œ

3. **í™•ìž¥ì„± ì œí•œ**
   - ëŒ€ê·œëª¨ ì„œë¹„ìŠ¤ì—ëŠ” ë¶€ì í•©
   - ë³´ì•ˆ ìš”êµ¬ì‚¬í•­ì´ ë†’ì€ ì„œë¹„ìŠ¤ì—ëŠ” ë¶€ì í•©

## ðŸ”’ Security Rules ì„¤ëª…

### users ì»¬ë ‰ì…˜

```javascript
allow update: if isOwner(userId) && (
  // ì¶©ì „: ìµœëŒ€ 1,000,000ì›ê¹Œì§€ ì¦ê°€ í—ˆìš©
  (request.resource.data.point > resource.data.point && 
   request.resource.data.point - resource.data.point <= 1000000) ||
  // ê±°ëž˜: ìµœëŒ€ 10,000,000ì›ê¹Œì§€ ê°ì†Œ í—ˆìš©
  (request.resource.data.point < resource.data.point &&
   resource.data.point - request.resource.data.point <= 10000000) ||
  // í¬ì¸íŠ¸ ë³€ê²½ ì—†ìŒ (ë‹¤ë¥¸ í•„ë“œë§Œ ìˆ˜ì •)
  request.resource.data.point == resource.data.point
);
```

### point_logs ì»¬ë ‰ì…˜

```javascript
allow create: if isAuthenticated() &&
                 request.resource.data.userId == request.auth.uid &&
                 request.resource.data.amount > 0 &&
                 request.resource.data.amount <= 10000000;
```

## ðŸ“ ê²°ë¡ 

- **ê°œì¸ í”„ë¡œì íŠ¸/í”„ë¡œí† íƒ€ìž…**: í˜„ìž¬ ë°©ì‹ìœ¼ë¡œ ì¶©ë¶„
- **ì†Œê·œëª¨ ì„œë¹„ìŠ¤**: Security Rules ê°•í™” í›„ ì‚¬ìš© ê°€ëŠ¥
- **ì¤‘ëŒ€í˜• ì„œë¹„ìŠ¤**: Cloud Functions ì‚¬ìš© ê°•ë ¥ ê¶Œìž¥

í˜„ìž¬ êµ¬í˜„ì€ **Spark í”Œëžœìœ¼ë¡œ ë¬´ë£Œ ì‚¬ìš© ê°€ëŠ¥**í•˜ì§€ë§Œ, **ë³´ì•ˆì„ ìœ„í•´ Cloud Functions ì‚¬ìš©ì„ ê¶Œìž¥**í•©ë‹ˆë‹¤.

